# ТЗ на сервис "Нарезка картинок"


## Общее описание

Сервис предназначен для изготовления preview (нарезки картинок)

## Архитектура

Сервис представляет собой Web-сервер (прокси), загружающий изображения,
нарезающий их до нужного формата и возвращающий пользователю.

## Основной обработчик
https://cut-service.com/crop/300/200/www.audubon.org/sites/default/files/a1_1902_16_barred-owl_sandra_rothenberg_kk.jpg
<---- микросервис ----><- нарезка -><--------- URL исходного изображения --------------------------------------------->

Сервис должен получить URL исходного изображения, скачать его, нарезать до необходимых размеров и вернуть как HTTP ответ.
Важно: необходимо проксировать все заголовки исходного HTTP запроса и заголовки ответа целевого сервиса (www.audubon.org в примере).

Сервис должен сохранить (кэшировать) полученное preview на локальном диске и при повторной загрузке. 
И при повторном запросе отдавать изображение с диска, без запроса к удаленному HTTP серверу.
Поскольку размер места для кэширования ограничен, необходимо использовать алгоритм Least-Recent-Used, 
для удаления редко используемых изображений.

## Развертывание
Нужно создать Docker - файл, и загрузить в публичный репозиторий, что бы все могли его использовать.
Сервис должен принимать настройку - разрешенный размер LRU кэша.

## Тестирование
Реализацию алгоритма LRU нужно покрыть Unit-тестами. Для интеграционного тестирования можно использовать
контейнер с nginx в качестве удаленного HTTP сервера. Необходимо проверить работу сервера в разных сценариях:
* картинка найдена в кeше
* удаленный сервер не существует
* удаленный сервер существует, но изображение не найдено 404
* Удаленный сервер существует, но изображение не изображение, а скажем exe-файл
* Удаленный сервер вернул ошибку


## Разбалловка

Максимум - 10 баллов

* Реализован HTTP сервер, проксирующий запросы к удаленному серверу - 1 балла
* Реализована нарезка изображений - 1 балл
* Кэширование нарезанных изображений на диске - 1 балл
* Ограничени кэша по месту (LRU кэш) - 1 балл
* Прокси сервер правильно передает заголовки запроса и ответа - 1 балл
* Код проходит проверку go vet, golint и race detector - 1 балл
* Написаны тесты - 1 балл
* Тесты адекватны и полностью покрывают фукнционал - 1 балл
* Проект запускаетcя в Docker и тестируется в docker-compose - 1 балл
* Проект возможно скомпилировать через `make build` и протестировать через `make test` - 1 балл


